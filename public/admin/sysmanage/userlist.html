<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<link rel="stylesheet" type="text/css" href="../easyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css" href="../easyui/themes/icon.css">
<script type="text/javascript" src="../easyui/jquery.min.js"></script>
<script type="text/javascript" src="../easyui/jquery.easyui.min.js"></script>
<title></title>
<script>
	//Ò³Ãæ¼ÓÔØ
	$(document).ready(function () {
		BindData();
		$("#tt").datagrid('getPager').pagination({
			onSelectPage:function(pageNum, pageSize){
				opts.pageNumber = pageNum;
				opts.pageSize = pageSize;
				BindData();
			}
		});
	});
	//°ó¶¨Êý¾Ý
	function BindData() {
		var pageNumber = $("#tt").datagrid('getPager').data("pagination").options.pageNumber;
		var pageSize = $("#tt").datagrid('getPager').data("pagination").options.pageSize;
		$.ajax({
			type: "get",
			url: 'http://www.qnck.dev/back/sys/user',
			data: {},
			dataType: "text",
			success: function (result) {
				alert(result);
			},
			error: function () {
				alert("¼ÓÔØÊ§°Ü!");
			}
		});
//		$("#tt").datagrid("loadData", data);
	}
	//²Ëµ¥°´Å¥µã»÷ÊÂ¼þ
	function toolBarClick(ty) {
		$("#displayinfo").attr("fnty", ty);
		switch (ty) {
			case "resh"://Ë¢ÐÂ
				BindData();
				break;
			case "add"://ÐÂÔö
				$('#user-dlg').dialog({ title: "ÐÂÔöÓÃ»§" });
				clearAllInputValue();//
				$('#user-dlg').dialog('open');
				break;
			case "upd"://ÐÞ¸Ä
				var sdata = $("#tt").datagrid("getSelected");
				if (sdata) {
					clearAllInputValue();
					putDataToWindow(sdata);
					$('#user-dlg').dialog({ title: "ÐÞ¸ÄÓÃ»§" });
					$('#user-dlg').dialog('open');
				} else {
					$.messager.alert("ÌáÊ¾", "ÇëÑ¡ÔñÒ»¸öÓÃ»§", "alert");
				}
				break;
			case "del"://É¾³ý
				deleteUser();
				break;
			default:
				break;
		}
	}
	//Çå¿Õ´°ÌåÔªËØÖµ
	function clearAllInputValue(){
		$("#account").val("");//ÓÃ»§ÕËºÅ
		$("#username").val("");//ÓÃ»§Ãû³Æ
		$("#password").val("");//ÓÃ»§ÃÜÂë
		$("#okpassword").val("");//ÓÃ»§ÃÜÂë
	}
	//°ó¶¨Ñ¡ÖÐÊý¾ÝÖÁÒ³ÃæÔªËØÖÐ
	function putDataToWindow(data) {
		$("#account").val(data.account);//ÓÃ»§ÕËºÅ
		$("#username").val(data.username);//ÓÃ»§Ãû³Æ
	}
	//ÑéÖ¤´°ÌåÔªËØÊäÈëÖµ
	function ckeckValue(obj) {
		var sid = $(obj).attr("id");
		var __val = $(obj).val();
		if (sid == "account" || sid == "username" || sid == "password") {
			if (__val == "") {
				$(obj).parent().next().children().show();
				return false;
			} else {
				clearError(obj);
				return true;
			}
		} else if (sid == "okpassword") {//ÑéÖ¤ÃÜÂë
			if (__val == "") {
				$(obj).parent().next().children().html("ÇëÔÙ´ÎÊäÈëÃÜÂë!").show();
				return false;
			} else if ($("#password").val() != __val) {
				$(obj).parent().next().children().html("ÃÜÂë²»Ò»ÖÂ!").show();
				return false;
			} else {
				clearError(obj);
				return true;
			}
		} 
	}
	//Çå³ý´íÎóÌáÊ¾
	function clearError(obj){
		$(obj).parent().next().children().hide();
	}
	//É¾³ýÓÃ»§
	function deleteUser() {
		var sdata = $("#tt").datagrid("getSelected");
		if (sdata) {
			$.messager.confirm("ÌáÊ¾", "È·ÈÏÉ¾³ý´Ë¼ÇÂ¼£¿", function (r) {
				if (r) {
					//µ÷ÓÃÉ¾³ýÓÃ»§½Ó¿Ú
					
					//·µ»ØÖµ´¦Àí
					if (true) {
						$("#tt").datagrid("deleteRow", rowindex);
					}
					else {
						$.messager.alert('ÌáÊ¾', 'É¾³ýÊ§°Ü£¡', 'info');
					}
				}
			});
		} else {
			$.messager.alert("ÌáÊ¾", "ÇëÑ¡ÔñÒ»¸öÓÃ»§", "alert");
		}
	}
	//»ñÈ¡Öµ
	function getDataFromWindow(){
		var rsData = { data: "", flag: true };
		var userObj = {};
		if (ckeckValue($("#account"))) {//ÓÃ»§´úÂë
			userObj.account = $("#account").val();
		} else {
			rsData.flag = false;
		}
	}
	//±£´æ²Ù×÷
	function saveUserClick(){
		var fnty = $("#displayinfo").attr("fnty");//·½·¨ÀàÐÍ
		var rsData = getDataFromWindow();
		if (rsData.flag) {
			//ÐÂÔö
			if (fnty == "add") {
				//¹Ø±Õµ¯³ö´°Ìå
				$("#user-dlg").dialog("close");
				//µ÷ÓÃÐÂÔö·½·¨½Ó¿Ú
			} else if (fnty == "upd") {
				//±à¼­µÄÊý¾Ý
				var sdata = $("#tt").datagrid("getSelected");
				//±à¼­Êý¾ÝµÄË÷Òý
				var rowindex = $("#tt").datagrid("getRowIndex", sdata);
				//±à¼­Êý¾ÝµÄid
				rsData.data.id = sdata.id;
				//¹Ø±Õµ¯³ö´°Ìå
				$("#user-dlg").dialog("close");
				//µ÷ÓÃÐÞ¸Ä·½·¨½Ó¿Ú
			}
		}
	}
	function formatHandle(value, row) {
		return rs = '<a class="alink-edit" href="#">[ÉèÖÃ½ÇÉ«]</a>';
	}
</script>
</head>

<body>
<table id="tt" title="ÓÃ»§ÁÐ±í" class="easyui-datagrid" data-options="
            rownumbers:true,
            fit:true,
            singleSelect:true,
            pagination:true,
            pageSize:20,
            idField:'id',
            toolbar:'#menuTollbar'">
    <thead>
        <tr>
            <th data-options="field:'username',width:120,align:'left',halign:'center',sortable:true">ÓÃ»§Ãû³Æ</th>
            <th data-options="field:'account',width:80,align:'left',halign:'center',sortable:true">ÓÃ»§ÕÊºÅ</th>
            <th data-options="field:'password',width:80,align:'left',halign:'center',sortable:true">ÓÃ»§ÃÜÂë</th>
            <th data-options="field:'createdate',width:180,align:'center',halign:'center',sortable:true">´´½¨Ê±¼ä</th>
            <th data-options="field:'updatedate',width:180,align:'center',sortable:true">×îºóÐÞ¸ÄÊ±¼ä</th>
            <th data-options="field:'options',width:120,align:'center',formatter:formatHandle">²Ù×÷</th>
        </tr>
    </thead>
</table>
<div id="menuTollbar" style="height: auto;">
    <a href="#" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-reload'" onclick="toolBarClick('resh');">Ë¢ÐÂ</a>
    <a href="#" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-add'" onclick="toolBarClick('add');">ÐÂÔö</a>
    <a href="#" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-edit'" onclick="toolBarClick('upd');">ÐÞ¸Ä</a>
    <a href="#" class="easyui-linkbutton" data-options="plain:true,iconCls:'icon-remove'" onclick="toolBarClick('del');">É¾³ý</a>
</div>

<!-- ÐÂÔö/±à¼­ÓÃ»§´°ÌåStart -->
<div id="user-dlg" class="easyui-dialog" title=" ÓÃ»§ÐÂÔö" style="width: 400px; height: 330px; padding: 5px"
    data-options="
        closed:true,
        modal:true,
        iconCls: 'icon-save',
        buttons: '#user-dlg-buttons'
    ">
    <div>
        <div id="displayinfo" fnty="add" style="display: none;">Òþ²ØµÄ´æ´¢ÐÅÏ¢²ã</div>
        <table class="userTab">
            <tr>
                <td class="td-key">ÓÃ»§ÕÊºÅ</td>
                <td style="width: 100px;">
                    <input id="account" next="username" type="text"  onblur="ckeckValue(this);" onfocus="clearError(this);" /></td>
                <td>
                    <div style="color: red; display: none;">ÓÃ»§ÕÊºÅ²»¿ÉÒÔÎª¿Õ!</div>
                </td>
            </tr>
            <tr>
                <td class="td-key">ÓÃ»§Ãû³Æ</td>
                <td>
                    <input id="username" next="password" type="text" onblur="ckeckValue(this);" onfocus="clearError(this);" /></td>
                <td>
                    <div style="color: red; display: none;">ÓÃ»§Ãû³Æ²»¿ÉÒÔÎª¿Õ!</div>
                </td>
            </tr>
            <tr>
                <td class="td-key">ÓÃ»§ÃÜÂë</td>
                <td>
                    <input id="password" next="okpassword" type="text" onblur="ckeckValue(this);" onfocus="clearError(this);" /></td>
                <td style="text-align: left;">
                    <div style="color: red; display: none;">ÓÃ»§ÃÜÂë²»¿ÉÒÔÎª¿Õ!</div>
                </td>
            </tr>
            <tr>
                <td class="td-key">È·ÈÏÃÜÂë</td>
                <td>
                    <input id="okpassword" next="pid" type="text" onblur="ckeckValue(this);" onfocus="clearError(this);" /></td>
                <td style="text-align: left;">
                    <div style="color: red; display: none;">ÇëÔÙ´ÎÊäÈëÃÜÂë!</div>
                </td>
            </tr>
        </table>
    </div>
</div>
<div id="user-dlg-buttons">
    <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-ok'" onclick="saveUserClick();">È·¶¨</a>
    <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-no'" onclick="$('#user-dlg').dialog('close');">È¡Ïû</a>
</div>
<!-- ÐÂÔö/±à¼­ÓÃ»§´°ÌåEnd -->
</body>
</html>
